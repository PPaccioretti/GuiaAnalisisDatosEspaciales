<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Sección 8 Predicción con múltiples capas de datos | Guía para el análisis de datos espaciales. Aplicaciones en agricultura</title>
  <meta name="description" content="DISEMINACIÓN CIENTÍFICA Y TRASNFERENCIA DE RESULTADOS DE INVESTIGACIÓN, PROMOVIDAS POR EL MINISTERIO DE CIENCIA Y TECNOLOGÍA DE LA PROVINCIA DE CÓRDOBA." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Sección 8 Predicción con múltiples capas de datos | Guía para el análisis de datos espaciales. Aplicaciones en agricultura" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="DISEMINACIÓN CIENTÍFICA Y TRASNFERENCIA DE RESULTADOS DE INVESTIGACIÓN, PROMOVIDAS POR EL MINISTERIO DE CIENCIA Y TECNOLOGÍA DE LA PROVINCIA DE CÓRDOBA." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Sección 8 Predicción con múltiples capas de datos | Guía para el análisis de datos espaciales. Aplicaciones en agricultura" />
  
  <meta name="twitter:description" content="DISEMINACIÓN CIENTÍFICA Y TRASNFERENCIA DE RESULTADOS DE INVESTIGACIÓN, PROMOVIDAS POR EL MINISTERIO DE CIENCIA Y TECNOLOGÍA DE LA PROVINCIA DE CÓRDOBA." />
  

<meta name="author" content="Mariano Córdoba" />
<meta name="author" content="Pablo Paccioretti" />
<meta name="author" content="Franca Giannini Kurina" />
<meta name="author" content="Cecilia Bruno" />
<meta name="author" content="Mónica Balzarini" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bases-de-datos-regionales.html"/>
<link rel="next" href="herramientas-de-software.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-154490537-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc2.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Guía para el análisis de datos espaciales en agricultura</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prólogo</a></li>
<li class="part"><span><b>I Aproximaciones metodológicas</b></span></li>
<li class="chapter" data-level="1" data-path="manejo-de-datos-espaciales.html"><a href="manejo-de-datos-espaciales.html"><i class="fa fa-check"></i><b>1</b> Manejo de datos espaciales</a><ul>
<li class="chapter" data-level="1.1" data-path="manejo-de-datos-espaciales.html"><a href="manejo-de-datos-espaciales.html#transformación-y-conversión-de-coordenadas"><i class="fa fa-check"></i><b>1.1</b> Transformación y conversión de coordenadas</a></li>
<li class="chapter" data-level="1.2" data-path="manejo-de-datos-espaciales.html"><a href="manejo-de-datos-espaciales.html#manipulación-de-múltiples-capas-de-datos"><i class="fa fa-check"></i><b>1.2</b> Manipulación de múltiples capas de datos</a></li>
<li class="chapter" data-level="1.3" data-path="manejo-de-datos-espaciales.html"><a href="manejo-de-datos-espaciales.html#depuración-de-datos"><i class="fa fa-check"></i><b>1.3</b> Depuración de datos</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html"><i class="fa fa-check"></i><b>2</b> Caracterización de variabilidad espacial</a><ul>
<li class="chapter" data-level="2.1" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#semivariogramas"><i class="fa fa-check"></i><b>2.1</b> Semivariogramas</a><ul>
<li class="chapter" data-level="2.1.1" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#ajuste-de-semivariogramas"><i class="fa fa-check"></i><b>2.1.1</b> Ajuste de semivariogramas</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#correlación-espacial-bivariada"><i class="fa fa-check"></i><b>2.2</b> Correlación espacial bivariada</a><ul>
<li class="chapter" data-level="2.2.1" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#coeficiente-de-correlación"><i class="fa fa-check"></i><b>2.2.1</b> Coeficiente de correlación</a></li>
<li class="chapter" data-level="2.2.2" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#coeficiente-de-co-dispersión"><i class="fa fa-check"></i><b>2.2.2</b> Coeficiente de co-dispersión</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#interpolación-kriging"><i class="fa fa-check"></i><b>2.3</b> Interpolación Kriging</a><ul>
<li class="chapter" data-level="2.3.1" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#kriging-ordinario"><i class="fa fa-check"></i><b>2.3.1</b> Kriging ordinario</a></li>
<li class="chapter" data-level="2.3.2" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#kriging-en-bloques"><i class="fa fa-check"></i><b>2.3.2</b> Kriging en bloques</a></li>
<li class="chapter" data-level="2.3.3" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#kriging-local"><i class="fa fa-check"></i><b>2.3.3</b> Kriging local</a></li>
<li class="chapter" data-level="2.3.4" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#kriging-universal"><i class="fa fa-check"></i><b>2.3.4</b> Kriging universal</a></li>
<li class="chapter" data-level="2.3.5" data-path="caracterización-de-variabilidad-espacial.html"><a href="caracterización-de-variabilidad-espacial.html#validación-cruzada"><i class="fa fa-check"></i><b>2.3.5</b> Validación cruzada</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos.html"><a href="caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos.html"><i class="fa fa-check"></i><b>3</b> Caracterización de variabilidad espacial con múltiples capas de datos</a><ul>
<li class="chapter" data-level="3.1" data-path="caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos.html"><a href="caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos.html#análisis-de-componentes-principales"><i class="fa fa-check"></i><b>3.1</b> Análisis de componentes principales</a></li>
<li class="chapter" data-level="3.2" data-path="caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos.html"><a href="caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos.html#análisis-de-conglomerados"><i class="fa fa-check"></i><b>3.2</b> Análisis de conglomerados</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="predicción-con-múltiples-capas-de-datos.html"><a href="predicción-con-múltiples-capas-de-datos.html"><i class="fa fa-check"></i><b>4</b> Predicción con múltiples capas de datos</a><ul>
<li class="chapter" data-level="4.1" data-path="predicción-con-múltiples-capas-de-datos.html"><a href="predicción-con-múltiples-capas-de-datos.html#regresión-con-errores-correlacionados-espacialmente-vía-reml"><i class="fa fa-check"></i><b>4.1</b> Regresión con errores correlacionados espacialmente vía REML</a></li>
<li class="chapter" data-level="4.2" data-path="predicción-con-múltiples-capas-de-datos.html"><a href="predicción-con-múltiples-capas-de-datos.html#regresión-con-efectos-aleatorios-de-sitio-vía-inla"><i class="fa fa-check"></i><b>4.2</b> Regresión con efectos aleatorios de sitio vía INLA</a></li>
<li class="chapter" data-level="4.3" data-path="predicción-con-múltiples-capas-de-datos.html"><a href="predicción-con-múltiples-capas-de-datos.html#regresión-vía-modelos-basados-en-árbol"><i class="fa fa-check"></i><b>4.3</b> Regresión vía modelos basados en árbol</a><ul>
<li class="chapter" data-level="4.3.1" data-path="predicción-con-múltiples-capas-de-datos.html"><a href="predicción-con-múltiples-capas-de-datos.html#bosques-aleatorios"><i class="fa fa-check"></i><b>4.3.1</b> Bosques aleatorios</a></li>
<li class="chapter" data-level="4.3.2" data-path="predicción-con-múltiples-capas-de-datos.html"><a href="predicción-con-múltiples-capas-de-datos.html#árboles-de-regresión-generalizados"><i class="fa fa-check"></i><b>4.3.2</b> Árboles de regresión generalizados</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Análisis de datos a escala fina</b></span></li>
<li class="chapter" data-level="5" data-path="implementación-con-r.html"><a href="implementación-con-r.html"><i class="fa fa-check"></i><b>5</b> Implementación con R</a><ul>
<li class="chapter" data-level="5.1" data-path="implementación-con-r.html"><a href="implementación-con-r.html#conversión-de-coordenadas-espaciales"><i class="fa fa-check"></i><b>5.1</b> Conversión de coordenadas espaciales</a></li>
<li class="chapter" data-level="5.2" data-path="implementación-con-r.html"><a href="implementación-con-r.html#eliminación-de-outliers-e-inliers"><i class="fa fa-check"></i><b>5.2</b> Eliminación de <em>outliers</em> e <em>inliers</em></a></li>
<li class="chapter" data-level="5.3" data-path="implementación-con-r.html"><a href="implementación-con-r.html#detección-de-tendencias-espaciales"><i class="fa fa-check"></i><b>5.3</b> Detección de tendencias espaciales</a></li>
<li class="chapter" data-level="5.4" data-path="implementación-con-r.html"><a href="implementación-con-r.html#cálculo-del-índice-de-moran"><i class="fa fa-check"></i><b>5.4</b> Cálculo del índice de Moran</a></li>
<li class="chapter" data-level="5.5" data-path="implementación-con-r.html"><a href="implementación-con-r.html#análisis-basado-en-semivariogramas"><i class="fa fa-check"></i><b>5.5</b> Análisis basado en semivariogramas</a><ul>
<li class="chapter" data-level="5.5.1" data-path="implementación-con-r.html"><a href="implementación-con-r.html#mapeo-de-la-variabilidad-espacial"><i class="fa fa-check"></i><b>5.5.1</b> Mapeo de la variabilidad espacial</a></li>
<li class="chapter" data-level="5.5.2" data-path="implementación-con-r.html"><a href="implementación-con-r.html#validación-cruzada-1"><i class="fa fa-check"></i><b>5.5.2</b> Validación cruzada</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="implementación-con-r.html"><a href="implementación-con-r.html#caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos-1"><i class="fa fa-check"></i><b>5.6</b> Caracterización de variabilidad espacial con múltiples capas de datos</a><ul>
<li class="chapter" data-level="5.6.1" data-path="implementación-con-r.html"><a href="implementación-con-r.html#análisis-de-componentes-principales-1"><i class="fa fa-check"></i><b>5.6.1</b> Análisis de componentes principales</a></li>
<li class="chapter" data-level="5.6.2" data-path="implementación-con-r.html"><a href="implementación-con-r.html#análisis-de-conglomerados-1"><i class="fa fa-check"></i><b>5.6.2</b> Análisis de conglomerados</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="implementación-con-r.html"><a href="implementación-con-r.html#predicción-con-múltiples-capas-de-datos-1"><i class="fa fa-check"></i><b>5.7</b> Predicción con múltiples capas de datos</a><ul>
<li class="chapter" data-level="5.7.1" data-path="implementación-con-r.html"><a href="implementación-con-r.html#kriging-con-deriva-externa"><i class="fa fa-check"></i><b>5.7.1</b> Kriging con deriva externa</a></li>
<li class="chapter" data-level="5.7.2" data-path="implementación-con-r.html"><a href="implementación-con-r.html#kriging-desde-modelo-de-regresión"><i class="fa fa-check"></i><b>5.7.2</b> Kriging desde modelo de regresión</a></li>
<li class="chapter" data-level="5.7.3" data-path="implementación-con-r.html"><a href="implementación-con-r.html#árboles-aleatorios"><i class="fa fa-check"></i><b>5.7.3</b> Árboles aleatorios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html"><i class="fa fa-check"></i><b>6</b> Implementación con InfoStat</a><ul>
<li class="chapter" data-level="6.1" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#conversión-de-coordenadas-espaciales-1"><i class="fa fa-check"></i><b>6.1</b> Conversión de coordenadas espaciales</a></li>
<li class="chapter" data-level="6.2" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#eliminación-de-outliers-e-inliers-1"><i class="fa fa-check"></i><b>6.2</b> Eliminación de <em>outliers</em> e <em>inliers</em></a></li>
<li class="chapter" data-level="6.3" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#detección-de-tendencias-espaciales-1"><i class="fa fa-check"></i><b>6.3</b> Detección de tendencias espaciales</a></li>
<li class="chapter" data-level="6.4" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#cálculo-del-índice-de-moran-1"><i class="fa fa-check"></i><b>6.4</b> Cálculo del índice de Moran</a></li>
<li class="chapter" data-level="6.5" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#análisis-basado-en-semivariogramas-1"><i class="fa fa-check"></i><b>6.5</b> Análisis basado en semivariogramas</a><ul>
<li class="chapter" data-level="6.5.1" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#mapeo-de-variabilidad-espacial"><i class="fa fa-check"></i><b>6.5.1</b> Mapeo de variabilidad espacial</a></li>
<li class="chapter" data-level="6.5.2" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#validación-cruzada-2"><i class="fa fa-check"></i><b>6.5.2</b> Validación cruzada</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#caracterización-de-variabilidad-espacial-con-múltiples-capas-de-datos-2"><i class="fa fa-check"></i><b>6.6</b> Caracterización de variabilidad espacial con múltiples capas de datos</a><ul>
<li class="chapter" data-level="6.6.1" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#análisis-de-componentes-principales-2"><i class="fa fa-check"></i><b>6.6.1</b> Análisis de componentes principales</a></li>
<li class="chapter" data-level="6.6.2" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#análisis-de-conglomerados-2"><i class="fa fa-check"></i><b>6.6.2</b> Análisis de conglomerados</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#predicción-con-múltiples-capas-de-datos-2"><i class="fa fa-check"></i><b>6.7</b> Predicción con múltiples capas de datos</a><ul>
<li class="chapter" data-level="6.7.1" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#kriging-con-deriva-externa-1"><i class="fa fa-check"></i><b>6.7.1</b> Kriging con deriva externa</a></li>
<li class="chapter" data-level="6.7.2" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#kriging-desde-modelo-de-regresión-1"><i class="fa fa-check"></i><b>6.7.2</b> Kriging desde modelo de regresión</a></li>
<li class="chapter" data-level="6.7.3" data-path="implementación-con-infostat.html"><a href="implementación-con-infostat.html#árboles-aleatorios-1"><i class="fa fa-check"></i><b>6.7.3</b> Árboles aleatorios</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Análisis de datos a escala regional</b></span></li>
<li class="chapter" data-level="7" data-path="bases-de-datos-regionales.html"><a href="bases-de-datos-regionales.html"><i class="fa fa-check"></i><b>7</b> Bases de datos regionales</a><ul>
<li class="chapter" data-level="7.1" data-path="bases-de-datos-regionales.html"><a href="bases-de-datos-regionales.html#manejo-de-datos-espaciales-1"><i class="fa fa-check"></i><b>7.1</b> Manejo de datos espaciales</a></li>
<li class="chapter" data-level="7.2" data-path="bases-de-datos-regionales.html"><a href="bases-de-datos-regionales.html#confección-de-grillas-de-predicción"><i class="fa fa-check"></i><b>7.2</b> Confección de grillas de predicción</a></li>
<li class="chapter" data-level="7.3" data-path="bases-de-datos-regionales.html"><a href="bases-de-datos-regionales.html#agregado-de-capas-de-información"><i class="fa fa-check"></i><b>7.3</b> Agregado de capas de información</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="predicción-con-múltiples-capas-de-datos-3.html"><a href="predicción-con-múltiples-capas-de-datos-3.html"><i class="fa fa-check"></i><b>8</b> Predicción con múltiples capas de datos</a><ul>
<li class="chapter" data-level="8.1" data-path="predicción-con-múltiples-capas-de-datos-3.html"><a href="predicción-con-múltiples-capas-de-datos-3.html#regresión-con-errores-correlacionados-espacialmente-vía-reml-1"><i class="fa fa-check"></i><b>8.1</b> Regresión con errores correlacionados espacialmente vía REML</a></li>
<li class="chapter" data-level="8.2" data-path="predicción-con-múltiples-capas-de-datos-3.html"><a href="predicción-con-múltiples-capas-de-datos-3.html#regresión-con-efectos-aleatorios-de-sitio-vía-inla-1"><i class="fa fa-check"></i><b>8.2</b> Regresión con efectos aleatorios de sitio vía INLA</a></li>
<li class="chapter" data-level="8.3" data-path="predicción-con-múltiples-capas-de-datos-3.html"><a href="predicción-con-múltiples-capas-de-datos-3.html#regresión-vía-modelos-basados-en-árbol-1"><i class="fa fa-check"></i><b>8.3</b> Regresión vía modelos basados en árbol</a></li>
</ul></li>
<li class="appendix"><span><b>Introducción a R</b></span></li>
<li class="chapter" data-level="A" data-path="herramientas-de-software.html"><a href="herramientas-de-software.html"><i class="fa fa-check"></i><b>A</b> Herramientas de software</a><ul>
<li class="chapter" data-level="A.1" data-path="herramientas-de-software.html"><a href="herramientas-de-software.html#introducción-al-manejo-de-datos-espaciales-con-r"><i class="fa fa-check"></i><b>A.1</b> Introducción al manejo de datos espaciales con R</a></li>
<li class="chapter" data-level="A.2" data-path="herramientas-de-software.html"><a href="herramientas-de-software.html#intérprete-de-r-en-infostat"><i class="fa fa-check"></i><b>A.2</b> Intérprete de R en InfoStat</a></li>
<li class="chapter" data-level="A.3" data-path="herramientas-de-software.html"><a href="herramientas-de-software.html#rstudio"><i class="fa fa-check"></i><b>A.3</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://www.agro.unc.edu.ar/~estadisticaaplicada" target="blank">Estadística Aplicada</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Guía para el análisis de datos espaciales. Aplicaciones en agricultura</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="predicción-con-múltiples-capas-de-datos-3" class="section level1">
<h1><span class="header-section-number">Sección 8</span> Predicción con múltiples capas de datos</h1>
<p>Una vez que se ha confeccionado la grilla de predicción y se ha unificado el sistema de referencia espacial entre las distintas capas de información, se comienza con el ajuste de modelos que luego serán usados para la predicción espacial en sitios sin datos. El objeto <code>suelos</code>, se utilizará para el ajuste de los modelos predictivos, mientras que <code>cetroide_pred</code> se usará para obtener predicciones para cada celda de la grilla.
La distribución espacial de la variable de interés (COS) puede visualizarse con funciones del paquete <code>tmap.</code> A través del argumento <code>palette</code> se modifica la paleta de colores, las opciones disponibles pueden buscarse ejecutando el comando <code>tmaptools::palette_explorer()</code>. También se pueden adicionar otras herramientas de estadística descriptiva, como por ejemplo un histograma de frecuencia mediante el argumento <code>legend.hist = TRUE</code>. Los estilos de los ejes y leyendas se pueden modificar con la función <code>tm_layout()</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">tm_shape</span>(suelos_sf) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="st">  </span><span class="kw">tm_dots</span>(</a>
<a class="sourceLine" id="cb115-3" data-line-number="3">    <span class="st">&quot;COS&quot;</span>,</a>
<a class="sourceLine" id="cb115-4" data-line-number="4">    <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>,</a>
<a class="sourceLine" id="cb115-5" data-line-number="5">    <span class="dt">size =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb115-6" data-line-number="6">    <span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>,</a>
<a class="sourceLine" id="cb115-7" data-line-number="7">    <span class="dt">legend.hist =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb115-8" data-line-number="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-9" data-line-number="9"><span class="st">  </span><span class="kw">tm_layout</span>(</a>
<a class="sourceLine" id="cb115-10" data-line-number="10">    <span class="dt">legend.format =</span> <span class="kw">list</span>(<span class="dt">text.separator =</span> <span class="st">&quot; a &quot;</span>),</a>
<a class="sourceLine" id="cb115-11" data-line-number="11">    <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb115-12" data-line-number="12">    <span class="dt">legend.hist.width =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb115-13" data-line-number="13">  )</a></code></pre></div>
<p><img src="figuras/figLibro/unnamed-chunk-172-1.png" width="\linewidth" style="display: block; margin: auto;" /></p>
<div id="regresión-con-errores-correlacionados-espacialmente-vía-reml-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Regresión con errores correlacionados espacialmente vía REML</h2>
<p>Se ajusta un modelo de regresión lineal con la función <code>gls()</code>, usando COS como variable dependiente y elevación, twi, arcilla y pH como variables predictoras. Primero, se ajusta suponiendo errores independientes (sin correlación espacial). Los resultados se guardan en el objeto denominado <code>ajuste_ML</code>. Seguidamente, se ajusta otro modelo de regresión con igual estructura para la componente sistemática, pero suponiendo que los términos de error aleatorio no son independientes sino que se correlacionan a través de un modelo de covarianza espacial. En particular, se ajusta el modelo de correlación espacial esférico y se suponen varianza residual única (modelo homcedástico). El método de estimación del modelo es REML. Los resultados se guardan en el objeto <code>ajuste_err_corr</code>.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">ajuste_ML &lt;-<span class="st"> </span><span class="kw">gls</span>(</a>
<a class="sourceLine" id="cb116-2" data-line-number="2">  COS <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>elevacion <span class="op">+</span><span class="st"> </span>twi <span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH,</a>
<a class="sourceLine" id="cb116-3" data-line-number="3">  <span class="dt">data =</span> suelos,</a>
<a class="sourceLine" id="cb116-4" data-line-number="4">  <span class="dt">method =</span> <span class="st">&quot;REML&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">ajuste_err_corr &lt;-<span class="st"> </span><span class="kw">gls</span>(</a>
<a class="sourceLine" id="cb117-2" data-line-number="2">  COS <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>elevacion <span class="op">+</span><span class="st"> </span>twi <span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH,</a>
<a class="sourceLine" id="cb117-3" data-line-number="3">  <span class="dt">data =</span> suelos,</a>
<a class="sourceLine" id="cb117-4" data-line-number="4">  <span class="dt">correlation =</span> <span class="kw">corSpher</span>(<span class="dt">form =</span>  <span class="op">~</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Y),</a>
<a class="sourceLine" id="cb117-5" data-line-number="5">  <span class="dt">method =</span> <span class="st">&quot;REML&quot;</span></a>
<a class="sourceLine" id="cb117-6" data-line-number="6">)</a></code></pre></div>
<p>Utilizando la función <code>summary()</code> se muestra a continuación el resultado del modelo sin correlación espacial (<code>objeto ajuste_ML</code>). Todos los términos del modelo, a excepción de elevacion resultaron significativos para un nivel de significación <span class="math inline">\(\alpha=0.05\)</span>. Se observó una correlación alta entre elevacion y twi (0,859), por esta colinealidad entre ambas variables, el término elevacion pudo no haber resultado significativo y podría sacarse del modelo. Se muestra también las características de la distribución de los residuos (mínimo, máximo valor y principales cuartiles). Es de esperar que los residuos estandarizados se encuentren en el intervalo [-3, 3], los valores fuera de este rango se consideran valores atípicos y podrían ser eliminados para reajustar el modelo. La varianza residual es el cuadrado de 4.58, indicando que desviaciones de 4,58 g/kg pueden existir por azar y que no se relacionan a las fuentes de variación reconocidas a priori.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw">summary</span>(ajuste_ML)</a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="co">#&gt; Generalized least squares fit by REML</span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="co">#&gt; Model: COS ~ 1 + elevacion + twi + arcilla +</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4">pH</a>
<a class="sourceLine" id="cb118-5" data-line-number="5"><span class="co">#&gt; Data: suelos</span></a>
<a class="sourceLine" id="cb118-6" data-line-number="6"><span class="co">#&gt; AIC BIC logLik</span></a>
<a class="sourceLine" id="cb118-7" data-line-number="7"><span class="co">#&gt; 2088 2111 -1038</span></a>
<a class="sourceLine" id="cb118-8" data-line-number="8"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb118-9" data-line-number="9"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb118-10" data-line-number="10"><span class="co">#&gt; Value Std.Error t-value p-value</span></a>
<a class="sourceLine" id="cb118-11" data-line-number="11"><span class="co">#&gt; (Intercept) 37,2 6,65 5,59 0,0000</span></a>
<a class="sourceLine" id="cb118-12" data-line-number="12"><span class="co">#&gt; elevacion 0,0 0,00 1,64 0,1016</span></a>
<a class="sourceLine" id="cb118-13" data-line-number="13"><span class="co">#&gt; twi -0,2 0,05 -4,49 0,0000</span></a>
<a class="sourceLine" id="cb118-14" data-line-number="14"><span class="co">#&gt; arcilla 0,3 0,03 10,83 0,0000</span></a>
<a class="sourceLine" id="cb118-15" data-line-number="15"><span class="co">#&gt; [ reached &#39;max&#39;</span></a>
<a class="sourceLine" id="cb118-16" data-line-number="16">    <span class="op">/</span><span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;max.print&quot;</span>) <span class="op">--</span></a>
<a class="sourceLine" id="cb118-17" data-line-number="17">omitted <span class="dv">1</span> rows ]</a>
<a class="sourceLine" id="cb118-18" data-line-number="18"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb118-19" data-line-number="19"><span class="co">#&gt; Correlation:</span></a>
<a class="sourceLine" id="cb118-20" data-line-number="20"><span class="co">#&gt; (Intr) elevcn twi arcill</span></a>
<a class="sourceLine" id="cb118-21" data-line-number="21"><span class="co">#&gt; elevacion -0,767</span></a>
<a class="sourceLine" id="cb118-22" data-line-number="22"><span class="co">#&gt; twi -0,919 0,859</span></a>
<a class="sourceLine" id="cb118-23" data-line-number="23"><span class="co">#&gt; arcilla -0,047 -0,001 -0,064</span></a>
<a class="sourceLine" id="cb118-24" data-line-number="24"><span class="co">#&gt; pH -0,347 -0,163 -0,035 0,040</span></a>
<a class="sourceLine" id="cb118-25" data-line-number="25"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb118-26" data-line-number="26"><span class="co">#&gt; Standardized residuals:</span></a>
<a class="sourceLine" id="cb118-27" data-line-number="27"><span class="co">#&gt; Min Q1 Med Q3 Max</span></a>
<a class="sourceLine" id="cb118-28" data-line-number="28"><span class="co">#&gt; -3,427 -0,596 -0,118 0,472 4,787</span></a>
<a class="sourceLine" id="cb118-29" data-line-number="29"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb118-30" data-line-number="30"><span class="co">#&gt; Residual standard error: 4,58</span></a>
<a class="sourceLine" id="cb118-31" data-line-number="31"><span class="co">#&gt; Degrees of freedom: 350 total; 345 residual</span></a></code></pre></div>
<p>Para el modelo ajustado suponiendo errores correlacionados, los criterios de información de AIC y BIC fueron menores que los obtenidos bajo el supuesto de errores independientes, indicando la conveniencia de considerar la correlación espacial. Los parámetros del modelo asociado a la componente aleatoria son rango = 17791,35 m y varianza residual igual al cuadrado de 4,56. Estos caracterizan la matriz de varianza y covarianza de los errores y proveen una estimación del semivariograma esférico que describe el proceso espacial subyacente, <em>i.e.</em> observaciones separadas por más de 17791,35 m no se encuentran correlacionadas y la varianza residual de las observaciones independientes o con distancias mayor al rango, expresada como desvío estándar, es 4,56.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">summary</span>(ajuste_err_corr)</a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="co">#&gt; Generalized least squares fit by REML</span></a>
<a class="sourceLine" id="cb119-3" data-line-number="3"><span class="co">#&gt; Model: COS ~ 1 + elevacion + twi + arcilla +</span></a>
<a class="sourceLine" id="cb119-4" data-line-number="4">pH</a>
<a class="sourceLine" id="cb119-5" data-line-number="5"><span class="co">#&gt; Data: suelos</span></a>
<a class="sourceLine" id="cb119-6" data-line-number="6"><span class="co">#&gt; AIC BIC logLik</span></a>
<a class="sourceLine" id="cb119-7" data-line-number="7"><span class="co">#&gt; 2078 2105 -1032</span></a>
<a class="sourceLine" id="cb119-8" data-line-number="8"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb119-9" data-line-number="9"><span class="co">#&gt; Correlation Structure: Spherical spatial</span></a>
<a class="sourceLine" id="cb119-10" data-line-number="10">correlation</a>
<a class="sourceLine" id="cb119-11" data-line-number="11"><span class="co">#&gt; Formula: ~X + Y</span></a>
<a class="sourceLine" id="cb119-12" data-line-number="12"><span class="co">#&gt; Parameter estimate(s):</span></a>
<a class="sourceLine" id="cb119-13" data-line-number="13"><span class="co">#&gt; range</span></a>
<a class="sourceLine" id="cb119-14" data-line-number="14"><span class="co">#&gt; 17791</span></a>
<a class="sourceLine" id="cb119-15" data-line-number="15"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb119-16" data-line-number="16"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb119-17" data-line-number="17"><span class="co">#&gt; Value Std.Error t-value p-value</span></a>
<a class="sourceLine" id="cb119-18" data-line-number="18"><span class="co">#&gt; (Intercept) 37,0 6,44 5,74 0,0000</span></a>
<a class="sourceLine" id="cb119-19" data-line-number="19"><span class="co">#&gt; elevacion 0,0 0,00 1,71 0,0877</span></a>
<a class="sourceLine" id="cb119-20" data-line-number="20"><span class="co">#&gt; twi -0,2 0,05 -4,41 0,0000</span></a>
<a class="sourceLine" id="cb119-21" data-line-number="21"><span class="co">#&gt; arcilla 0,3 0,03 12,49 0,0000</span></a>
<a class="sourceLine" id="cb119-22" data-line-number="22"><span class="co">#&gt; [ reached &#39;max&#39;</span></a>
<a class="sourceLine" id="cb119-23" data-line-number="23">    <span class="op">/</span><span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;max.print&quot;</span>) <span class="op">--</span></a>
<a class="sourceLine" id="cb119-24" data-line-number="24">omitted <span class="dv">1</span> rows ]</a>
<a class="sourceLine" id="cb119-25" data-line-number="25"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb119-26" data-line-number="26"><span class="co">#&gt; Correlation:</span></a>
<a class="sourceLine" id="cb119-27" data-line-number="27"><span class="co">#&gt; (Intr) elevcn twi arcill</span></a>
<a class="sourceLine" id="cb119-28" data-line-number="28"><span class="co">#&gt; elevacion -0,763</span></a>
<a class="sourceLine" id="cb119-29" data-line-number="29"><span class="co">#&gt; twi -0,916 0,853</span></a>
<a class="sourceLine" id="cb119-30" data-line-number="30"><span class="co">#&gt; arcilla -0,218 0,083 0,038</span></a>
<a class="sourceLine" id="cb119-31" data-line-number="31"><span class="co">#&gt; pH -0,285 -0,224 -0,108 0,260</span></a>
<a class="sourceLine" id="cb119-32" data-line-number="32"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb119-33" data-line-number="33"><span class="co">#&gt; Standardized residuals:</span></a>
<a class="sourceLine" id="cb119-34" data-line-number="34"><span class="co">#&gt; Min Q1 Med Q3 Max</span></a>
<a class="sourceLine" id="cb119-35" data-line-number="35"><span class="co">#&gt; -3,415 -0,578 -0,117 0,476 4,843</span></a>
<a class="sourceLine" id="cb119-36" data-line-number="36"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb119-37" data-line-number="37"><span class="co">#&gt; Residual standard error: 4,57</span></a>
<a class="sourceLine" id="cb119-38" data-line-number="38"><span class="co">#&gt; Degrees of freedom: 350 total; 345 residual</span></a></code></pre></div>
<p>Las predicciones se realizaron utilizando la función <code>predict()</code> sobre los centroides de la grilla de predicción utilizando el mejor modelo entre los ajustados. Se convierte el objeto <code>centroide_pred</code> en un <code>data.frame</code>, eliminando del objeto <code>centroide_pred</code> la columna que contiene las características espaciales mediante la función <code>st_drop_geometry()</code> y extrayendo mediante la función <code>st_coordinates()</code>, las coordenadas sin los atributos espaciales. Estas partes se guardan en el objeto <code>suelos_pred</code> de clase <code>data.frame</code>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">suelos_pred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb120-2" data-line-number="2">  <span class="kw">st_drop_geometry</span>(centroide_pred),</a>
<a class="sourceLine" id="cb120-3" data-line-number="3">  <span class="kw">st_coordinates</span>(centroide_pred))</a>
<a class="sourceLine" id="cb120-4" data-line-number="4"></a>
<a class="sourceLine" id="cb120-5" data-line-number="5"></a>
<a class="sourceLine" id="cb120-6" data-line-number="6">pred_ajuste_err_corr &lt;-<span class="st"> </span><span class="kw">predict</span>(</a>
<a class="sourceLine" id="cb120-7" data-line-number="7">  ajuste_err_corr,</a>
<a class="sourceLine" id="cb120-8" data-line-number="8">  <span class="dt">newdata =</span> suelos_pred,</a>
<a class="sourceLine" id="cb120-9" data-line-number="9">  <span class="dt">na.action =</span> na.pass)</a></code></pre></div>
<p>Los predichos se adicionan al objeto <code>centroide_pred</code> utilizando la función <code>cbind()</code>. Para que la visualización de estos valores, se pueda realizar utilizando los polígonos de la grilla de predicción en vez de los centroides, se deben adicionar los predichos mediante la función <code>st_join()</code>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">pred_err_corr &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb121-2" data-line-number="2">  centroide_pred,</a>
<a class="sourceLine" id="cb121-3" data-line-number="3">  <span class="st">&quot;COS_pred&quot;</span> =<span class="st"> </span>pred_ajuste_err_corr)</a>
<a class="sourceLine" id="cb121-4" data-line-number="4"></a>
<a class="sourceLine" id="cb121-5" data-line-number="5">pred_err_corr &lt;-<span class="st"> </span><span class="kw">st_join</span>(</a>
<a class="sourceLine" id="cb121-6" data-line-number="6">  grilla_pred,</a>
<a class="sourceLine" id="cb121-7" data-line-number="7">  pred_err_corr)</a>
<a class="sourceLine" id="cb121-8" data-line-number="8"></a>
<a class="sourceLine" id="cb121-9" data-line-number="9"><span class="kw">tm_shape</span>(pred_err_corr) <span class="op">+</span></a>
<a class="sourceLine" id="cb121-10" data-line-number="10"><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&quot;COS_pred&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;cont&quot;</span>,</a>
<a class="sourceLine" id="cb121-11" data-line-number="11">          <span class="dt">title =</span> <span class="st">&quot;Predichos COS (g/kg)&quot;</span>)</a></code></pre></div>
<p><img src="figuras/figLibro/unnamed-chunk-178-1.png" width="\linewidth" style="display: block; margin: auto;" /></p>
</div>
<div id="regresión-con-efectos-aleatorios-de-sitio-vía-inla-1" class="section level2">
<h2><span class="header-section-number">8.2</span> Regresión con efectos aleatorios de sitio vía INLA</h2>
<p>Para abordar la regresión bayesiana de datos espaciales, primero se define el predictor lineal ajustando un modelo de regresión lineal con la función <code>inla()</code>. INLA representa una combinación de aproximaciones analíticas y esquemas de integración numérica eficiente para obtener una aproximación confiable de la distribución a posteriori de interés. En el ejemplo de ilustración, se usa COS como variable dependiente y elevación, twi, arcilla y pH como variables predictoras y no se ha contemplado la estructura de correlación espacial. Se especifica la distribución que se asume para la variable respuesta a través del argumento <code>family</code>. El cómputo de las medidas para evaluación y comparación de modelos se realiza con el argumento <code>control.compute</code> especificando la medida que se pretende. Para explorar las opciones disponibles para la evaluación y comparación de modelos se ejecuta el comando <code>?control.compute</code> (en el ejemplo, se solicita el criterio DIC).</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">ajuste_INLA &lt;-<span class="st"> </span><span class="kw">inla</span>(</a>
<a class="sourceLine" id="cb122-2" data-line-number="2">  COS <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>elevacion <span class="op">+</span><span class="st"> </span>twi <span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH,</a>
<a class="sourceLine" id="cb122-3" data-line-number="3">  <span class="dt">family =</span> <span class="st">&#39;gaussian&#39;</span>,</a>
<a class="sourceLine" id="cb122-4" data-line-number="4">  <span class="dt">data =</span> suelos,</a>
<a class="sourceLine" id="cb122-5" data-line-number="5">  <span class="dt">control.compute =</span> <span class="kw">list</span>(<span class="dt">dic =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p>El modelo ajustado es retornado como un objeto INLA. Este provee información sobre el tiempo de procesado y algunos estadísticos sobre las distribuciones a posteriori de los coeficientes de regresión (efectos fijos) y de los hiperparámetros. Para el modelo ajustado se observan los intervalos de credibilidad del 95% para los coeficientes de regresión asociados a cada una de las variables predictoras (predictor lineal) y como hiperparámetro la precisión de las observaciones de COS. En este ajuste, no hubo efectos aleatorios ni especificaciones relacionadas a la espacialidad de los datos.
El intervalo de credibilidad contiene al verdadero parámetro con un 95% de probabilidad. Luego, el ajusta indica que todas las variables impactan a la respuesta, excepto la variable elevación para la cual el desvío estándar (sd) es alto relativo a la media de la distribución del coeficiente de regresión y el intervalo de credibilidad contiene al 0. Podría ser oportuno realizar un nuevo ajuste sin esta variable, que como se ha especificado anteriormente está altamente correlacionada con twi. La media a posteriori para el coeficiente de regresión que acompaña el pH es -0,766 con un intervalo de credibilidad del 95% entre -1,516 y -0,017, por lo que se interpreta que a mayores valores de pH se tendrán menores valores de COS. Se muestra también el intervalo de credibilidad [0,041; 0,055] para la precisión (inversa de la varianza <span class="math inline">\(1/\sigma_e^2\)</span> ), la estimación es 0,048 y por tanto la varianza residual es próxima a 20 o el error estándar residual cercano a 4,56. El valor de DIC, el cual es una función de la deviance del modelo y de una medida del número efectivo de parámetros del modelo, es 2065,79`. El numero efectivo de parámetros es una cantidad que caracteriza la complejidad del modelo y que no solo depende de la cantidad de parámetros sino también de la dependencia entre ellos. Esta medida puede ser usada para comparar modelos, menores valores indican mejor ajuste del modelo a los datos. El mejor de los modelos ajustados, también tendrá menor diferencia entre el valor de DIC para ese modelo y el valor de DIC para el modelo saturado. La verosimilitud marginal es otro criterio usado en selección de modelos en estadística bayesiana, al reportarse en escala log menor valor indica mejor ajuste. R-INLA obtiene las distribuciones marginales a posteriori para todos los parámetros del modelo.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">summary</span>(ajuste_INLA)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb123-4" data-line-number="4"><span class="co">#&gt; c(&quot;inla(formula = COS ~ 1 + elevacion + twi</span></a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH, family =</a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="co">#&gt; \&quot;gaussian\&quot;, &quot;, &quot; data = suelos,</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7">control.compute =<span class="st"> </span><span class="kw">list</span>(<span class="dt">dic =</span> <span class="ot">TRUE</span>)<span class="er">)</span><span class="st">&quot;)</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="st">#&gt; Time used:</span></a>
<a class="sourceLine" id="cb123-9" data-line-number="9"><span class="st">#&gt; Pre = 0,569, Running = 0,137, Post = 0,0578,</span></a>
<a class="sourceLine" id="cb123-10" data-line-number="10"><span class="st">Total = 0,763</span></a>
<a class="sourceLine" id="cb123-11" data-line-number="11"><span class="st">#&gt; Fixed effects:</span></a>
<a class="sourceLine" id="cb123-12" data-line-number="12"><span class="st">#&gt; mean sd 0.025quant 0.5quant 0.975quant mode</span></a>
<a class="sourceLine" id="cb123-13" data-line-number="13"><span class="st">kld</span></a>
<a class="sourceLine" id="cb123-14" data-line-number="14"><span class="st">#&gt; (Intercept) 37,171 6,654 24,100 37,171</span></a>
<a class="sourceLine" id="cb123-15" data-line-number="15"><span class="st">50,231 37,171 0</span></a>
<a class="sourceLine" id="cb123-16" data-line-number="16"><span class="st">#&gt; elevacion 0,003 0,002 -0,001 0,003 0,008</span></a>
<a class="sourceLine" id="cb123-17" data-line-number="17"><span class="st">0,003 0</span></a>
<a class="sourceLine" id="cb123-18" data-line-number="18"><span class="st">#&gt; [ reached getOption(&quot;</span>max.print<span class="st">&quot;) -- omitted</span></a>
<a class="sourceLine" id="cb123-19" data-line-number="19"><span class="st">3 rows ]</span></a>
<a class="sourceLine" id="cb123-20" data-line-number="20"><span class="st">#&gt;</span></a>
<a class="sourceLine" id="cb123-21" data-line-number="21"><span class="st">#&gt; Model hyperparameters:</span></a>
<a class="sourceLine" id="cb123-22" data-line-number="22"><span class="st">#&gt; mean sd 0.025quant 0.5quant 0.975quant</span></a>
<a class="sourceLine" id="cb123-23" data-line-number="23"><span class="st">#&gt; Precision for the Gaussian observations</span></a>
<a class="sourceLine" id="cb123-24" data-line-number="24"><span class="st">0,048 0,004 0,041 0,048 0,055</span></a>
<a class="sourceLine" id="cb123-25" data-line-number="25"><span class="st">#&gt; mode</span></a>
<a class="sourceLine" id="cb123-26" data-line-number="26"><span class="st">#&gt; Precision for the Gaussian observations</span></a>
<a class="sourceLine" id="cb123-27" data-line-number="27"><span class="st">0,048</span></a>
<a class="sourceLine" id="cb123-28" data-line-number="28"><span class="st">#&gt;</span></a>
<a class="sourceLine" id="cb123-29" data-line-number="29"><span class="st">#&gt; Expected number of effective</span></a>
<a class="sourceLine" id="cb123-30" data-line-number="30"><span class="st">parameters(stdev): 5,00(0,00)</span></a>
<a class="sourceLine" id="cb123-31" data-line-number="31"><span class="st">#&gt; Number of equivalent replicates : 70,00</span></a>
<a class="sourceLine" id="cb123-32" data-line-number="32"><span class="st">#&gt;</span></a>
<a class="sourceLine" id="cb123-33" data-line-number="33"><span class="st">#&gt; Deviance Information Criterion (DIC)</span></a>
<a class="sourceLine" id="cb123-34" data-line-number="34"><span class="st">...............: 2065,80</span></a>
<a class="sourceLine" id="cb123-35" data-line-number="35"><span class="st">#&gt; Deviance Information Criterion (DIC,</span></a>
<a class="sourceLine" id="cb123-36" data-line-number="36"><span class="st">saturated) ....: 359,50</span></a>
<a class="sourceLine" id="cb123-37" data-line-number="37"><span class="st">#&gt; Effective number of parameters</span></a>
<a class="sourceLine" id="cb123-38" data-line-number="38"><span class="st">.....................: 6,08</span></a>
<a class="sourceLine" id="cb123-39" data-line-number="39"><span class="st">#&gt;</span></a>
<a class="sourceLine" id="cb123-40" data-line-number="40"><span class="st">#&gt; Marginal log-Likelihood: -1070,11</span></a>
<a class="sourceLine" id="cb123-41" data-line-number="41"><span class="st">#&gt; Posterior marginals for the linear predictor</span></a>
<a class="sourceLine" id="cb123-42" data-line-number="42"><span class="st">and</span></a>
<a class="sourceLine" id="cb123-43" data-line-number="43"><span class="st">#&gt; the fitted values are computed</span></a></code></pre></div>
<p>Los efectos aleatorios en INLA se incluyen en la formula del predictor lineal usando la función <code>f()</code>. Para el ejemplo de ilustración, más abajo se ajusta el modelo de regresión donde se adiciona un efecto aleatorio de sitio para caracterizar el proceso espacial subyacente a los datos. Dado que la función <code>f()</code> se valúa sobre un red de nodos conformada a partir de las observaciones, es primero necesario construir una malla que cubra el dominio espacial y definir un objeto que contiene la identificación de los nodos con observaciones. La malla se arma con la función <code>inla.mesh.2d()</code> cuyos argumentos o parámetros de la malla son: <code>cutoff</code> define la distancia mínima entre vértices de los triángulos que conforman la malla y <code>max.edge</code> que refiere a la longitud máxima del lado de cada triángulo. Por defecto, la malla se construye con el método de triangulación de Delauny. Sobre esta malla se construye el objeto nodos.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">sitios &lt;-<span class="st"> </span>suelos[, <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)]</a>
<a class="sourceLine" id="cb124-2" data-line-number="2"></a>
<a class="sourceLine" id="cb124-3" data-line-number="3">malla &lt;-<span class="st"> </span><span class="kw">inla.mesh.2d</span>(sitios, <span class="dt">cutoff =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb124-4" data-line-number="4">                      <span class="dt">max.edge =</span> <span class="dv">200000</span>)</a>
<a class="sourceLine" id="cb124-5" data-line-number="5"></a>
<a class="sourceLine" id="cb124-6" data-line-number="6">nodos &lt;-<span class="st"> </span>malla<span class="op">$</span>idx<span class="op">$</span>loc</a></code></pre></div>
<p>Para estimar la matriz de varianzas y covarianzas de los efectos de sitio por el método SPDE se utiliza la función <code>inla.spde2.matern()</code>. Un argumento a especificar es el parámetro <span class="math inline">\(\alpha\)</span> (que varía entre 0 y 2). Por defecto es 2 para aproxima una función de correlación espacial del tipo exponencial como modelo de correlación espacial entre los efectos de sitio.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">spde &lt;-<span class="st"> </span><span class="kw">inla.spde2.matern</span>(<span class="dt">mesh =</span> malla,</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">                          <span class="dt">alpha =</span> <span class="dv">2</span>)</a></code></pre></div>
<p>Luego de identificar los nodos sobre la malla, se ajusta el modelo de regresión con efecto aleatorio de sitio usando la función <code>inla()</code>. Los resultados del objeto INLA resultante incluyen las distribuciones a posteriori de los efectos latentes y de los hiperparámetros, así como estadísticos de resumen. Como se ejemplifica adelante, pueden obtenerse estimaciones a posteriori de parámetros del campo espacial latente.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">ajuste_INLAspde &lt;-<span class="st"> </span><span class="kw">inla</span>(</a>
<a class="sourceLine" id="cb126-2" data-line-number="2">  COS <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>elevacion <span class="op">+</span><span class="st"> </span>twi <span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH <span class="op">+</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="st">    </span><span class="kw">f</span>(nodos, <span class="dt">model =</span> spde, <span class="dt">diagonal =</span> <span class="fl">1e-6</span>),</a>
<a class="sourceLine" id="cb126-4" data-line-number="4">  <span class="dt">family =</span> <span class="st">&#39;gaussian&#39;</span>,</a>
<a class="sourceLine" id="cb126-5" data-line-number="5">  <span class="dt">data =</span> suelos,</a>
<a class="sourceLine" id="cb126-6" data-line-number="6">  <span class="dt">control.compute =</span> <span class="kw">list</span>(<span class="dt">dic =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb126-7" data-line-number="7">  <span class="dt">control.predictor =</span> <span class="kw">list</span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb126-8" data-line-number="8"></a>
<a class="sourceLine" id="cb126-9" data-line-number="9"><span class="kw">summary</span>(ajuste_INLAspde)</a>
<a class="sourceLine" id="cb126-10" data-line-number="10"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb126-11" data-line-number="11"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb126-12" data-line-number="12"><span class="co">#&gt; c(&quot;inla(formula = COS ~ 1 + elevacion + twi</span></a>
<a class="sourceLine" id="cb126-13" data-line-number="13"><span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH <span class="op">+</span><span class="st"> </span><span class="kw">f</span>(nodos, <span class="st">&quot;, &quot;</span></a>
<a class="sourceLine" id="cb126-14" data-line-number="14"><span class="co">#&gt; model = spde, diagonal = 1e-06), family =</span></a>
<a class="sourceLine" id="cb126-15" data-line-number="15">\<span class="st">&quot;gaussian</span><span class="ch">\&quot;</span><span class="st">, data = suelos, &quot;</span>, <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb126-16" data-line-number="16"><span class="st">#&gt; control.compute = list(dic = TRUE),</span></a>
<a class="sourceLine" id="cb126-17" data-line-number="17"><span class="st">control.predictor = list(compute =</span></a>
<a class="sourceLine" id="cb126-18" data-line-number="18"><span class="st">#&gt; TRUE))&quot;</span> )</a>
<a class="sourceLine" id="cb126-19" data-line-number="19"><span class="co">#&gt; Time used:</span></a>
<a class="sourceLine" id="cb126-20" data-line-number="20"><span class="co">#&gt; Pre = 0,642, Running = 1,98, Post = 0,0806,</span></a>
<a class="sourceLine" id="cb126-21" data-line-number="21">Total =<span class="st"> </span><span class="dv">2</span>,<span class="dv">7</span></a>
<a class="sourceLine" id="cb126-22" data-line-number="22"><span class="co">#&gt; Fixed effects:</span></a>
<a class="sourceLine" id="cb126-23" data-line-number="23"><span class="co">#&gt; mean sd 0.025quant 0.5quant 0.975quant mode</span></a>
<a class="sourceLine" id="cb126-24" data-line-number="24">kld</a>
<a class="sourceLine" id="cb126-25" data-line-number="25"><span class="co">#&gt; (Intercept) 47,928 7,207 33,782 47,923</span></a>
<a class="sourceLine" id="cb126-26" data-line-number="26"><span class="dv">62</span>,<span class="dv">089</span> <span class="dv">47</span>,<span class="dv">913</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb126-27" data-line-number="27"><span class="co">#&gt; elevacion 0,004 0,003 -0,001 0,004 0,009</span></a>
<a class="sourceLine" id="cb126-28" data-line-number="28"><span class="dv">0</span>,<span class="dv">004</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb126-29" data-line-number="29"><span class="co">#&gt; [ reached getOption(&quot;max.print&quot;) -- omitted</span></a>
<a class="sourceLine" id="cb126-30" data-line-number="30"><span class="dv">3</span> rows ]</a>
<a class="sourceLine" id="cb126-31" data-line-number="31"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb126-32" data-line-number="32"><span class="co">#&gt; Random effects:</span></a>
<a class="sourceLine" id="cb126-33" data-line-number="33"><span class="co">#&gt; Name Model</span></a>
<a class="sourceLine" id="cb126-34" data-line-number="34"><span class="co">#&gt; nodos SPDE2 model</span></a>
<a class="sourceLine" id="cb126-35" data-line-number="35"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb126-36" data-line-number="36"><span class="co">#&gt; Model hyperparameters:</span></a>
<a class="sourceLine" id="cb126-37" data-line-number="37"><span class="co">#&gt; mean sd 0.025quant 0.5quant 0.975quant</span></a>
<a class="sourceLine" id="cb126-38" data-line-number="38"><span class="co">#&gt; Precision for the Gaussian observations</span></a>
<a class="sourceLine" id="cb126-39" data-line-number="39"><span class="dv">0</span>,<span class="dv">069</span> <span class="dv">0</span>,<span class="dv">007</span> <span class="dv">0</span>,<span class="dv">057</span> <span class="dv">0</span>,<span class="dv">069</span> <span class="dv">0</span>,<span class="dv">083</span></a>
<a class="sourceLine" id="cb126-40" data-line-number="40"><span class="co">#&gt; Theta1 for nodos 8,579 0,154 8,291 8,574</span></a>
<a class="sourceLine" id="cb126-41" data-line-number="41"><span class="dv">8</span>,<span class="dv">895</span></a>
<a class="sourceLine" id="cb126-42" data-line-number="42"><span class="co">#&gt; mode</span></a>
<a class="sourceLine" id="cb126-43" data-line-number="43"><span class="co">#&gt; Precision for the Gaussian observations</span></a>
<a class="sourceLine" id="cb126-44" data-line-number="44"><span class="dv">0</span>,<span class="dv">069</span></a>
<a class="sourceLine" id="cb126-45" data-line-number="45"><span class="co">#&gt; Theta1 for nodos 8,554</span></a>
<a class="sourceLine" id="cb126-46" data-line-number="46"><span class="co">#&gt; [ reached &#39;max&#39;</span></a>
<a class="sourceLine" id="cb126-47" data-line-number="47">    <span class="op">/</span><span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;max.print&quot;</span>) <span class="op">--</span></a>
<a class="sourceLine" id="cb126-48" data-line-number="48">omitted <span class="dv">1</span> rows ]</a>
<a class="sourceLine" id="cb126-49" data-line-number="49"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb126-50" data-line-number="50"><span class="co">#&gt; Expected number of effective</span></a>
<a class="sourceLine" id="cb126-51" data-line-number="51"><span class="kw">parameters</span>(stdev)<span class="op">:</span><span class="st"> </span><span class="dv">52</span>,<span class="dv">76</span>(<span class="dv">9</span>,<span class="dv">84</span>)</a>
<a class="sourceLine" id="cb126-52" data-line-number="52"><span class="co">#&gt; Number of equivalent replicates : 6,63</span></a>
<a class="sourceLine" id="cb126-53" data-line-number="53"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb126-54" data-line-number="54"><span class="co">#&gt; Deviance Information Criterion (DIC)</span></a>
<a class="sourceLine" id="cb126-55" data-line-number="55">...............<span class="op">:</span><span class="st"> </span><span class="dv">1988</span>,<span class="dv">52</span></a>
<a class="sourceLine" id="cb126-56" data-line-number="56"><span class="co">#&gt; Deviance Information Criterion (DIC,</span></a>
<a class="sourceLine" id="cb126-57" data-line-number="57">saturated<span class="er">)</span> ....<span class="op">:</span><span class="st"> </span><span class="dv">412</span>,<span class="dv">04</span></a>
<a class="sourceLine" id="cb126-58" data-line-number="58"><span class="co">#&gt; Effective number of parameters</span></a>
<a class="sourceLine" id="cb126-59" data-line-number="59">.....................<span class="op">:</span><span class="st"> </span><span class="dv">54</span>,<span class="dv">42</span></a>
<a class="sourceLine" id="cb126-60" data-line-number="60"><span class="co">#&gt;</span></a>
<a class="sourceLine" id="cb126-61" data-line-number="61"><span class="co">#&gt; Marginal log-Likelihood: -1049,41</span></a>
<a class="sourceLine" id="cb126-62" data-line-number="62"><span class="co">#&gt; Posterior marginals for the linear predictor</span></a>
<a class="sourceLine" id="cb126-63" data-line-number="63">and</a>
<a class="sourceLine" id="cb126-64" data-line-number="64"><span class="co">#&gt; the fitted values are computed</span></a></code></pre></div>
<p>El objeto resultante provee información sobre los intervalos de credibilidad del 95% de los coeficientes de regresión y de los hiperparámetros. Estos son además de la precisión <code>Theta1</code> y <code>Theta2</code> que definen la función de correlación espacial subyacente. Los parámetros <code>Theta1</code> y <code>Theta2</code> no son de interpretación directa, pero dependen de los parámetros que caracterizan el proceso espacial (rango y varianza estructural). Utilizando la función <code>inla.spde2.result()</code> se puede obtener la distribución a posteriori de los parámetros expresadas en términos de rango y varianza estructural.</p>
<!-- ```{r, echo=FALSE, purl=FALSE} -->
<!-- options(OutDec = ".") -->
<!-- ``` -->
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">resultados_spde &lt;-</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="st">  </span><span class="kw">inla.spde2.result</span>(<span class="dt">inla =</span> ajuste_INLAspde,</a>
<a class="sourceLine" id="cb127-3" data-line-number="3">                    <span class="dt">name =</span> <span class="st">&quot;nodos&quot;</span>, <span class="dt">spde =</span> spde)</a>
<a class="sourceLine" id="cb127-4" data-line-number="4"></a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="kw">inla.emarginal</span>(<span class="cf">function</span>(x) </a>
<a class="sourceLine" id="cb127-6" data-line-number="6">  x, </a>
<a class="sourceLine" id="cb127-7" data-line-number="7">  resultados_spde<span class="op">$</span>marginals.range.nominal[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb127-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb127-9" data-line-number="9"><span class="co">#&gt; [1] 175820</span></a>
<a class="sourceLine" id="cb127-10" data-line-number="10"></a>
<a class="sourceLine" id="cb127-11" data-line-number="11"><span class="kw">inla.emarginal</span>(<span class="cf">function</span>(x) </a>
<a class="sourceLine" id="cb127-12" data-line-number="12">  x, </a>
<a class="sourceLine" id="cb127-13" data-line-number="13">  resultados_spde<span class="op">$</span>marginals.variance.nominal[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb127-14" data-line-number="14"><span class="co">#&gt; [1] 9,45</span></a></code></pre></div>
<!-- ```{r, echo=FALSE, purl=FALSE} -->
<!-- options(OutDec = ",") -->
<!-- ``` -->
<p>Para comparar los modelos de regresión ajustados con errores independientes y con correlación espacial se visualizan medidas de bondad de ajuste como DIC para ambos modelos.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw">c</span>(ajuste_INLA<span class="op">$</span>dic<span class="op">$</span>dic, ajuste_INLAspde<span class="op">$</span>dic<span class="op">$</span>dic)</a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="co">#&gt; [1] 2066 1989</span></a></code></pre></div>
<p>Comparando los valores de DIC se deduce la conveniencia de usar un modelo con correlación espacial respecto a uno que supone los valores de COS independientes.</p>
<p>En R-INLA no existe una funcion <code>predict()</code> como en gls. Las predicciones deben ser obtenidas como parte del modelo ajustado. Dado que las predicciones puedes ser entendida como el ajuste de un modelo con datos faltante simplemente se especificará, antes del ajuste, <code>y[i] = NA</code> para aquellos sitios donde se desea predecir. Las distribuciones de los valores predichos no son devueltas directamente, pero se pueden explorar. INLA retorna las a posteriori marginales para los efectos aleatorios y para el predictor linear en el sitio faltante. Adicionando el ruido de las observaciones a los valores ajustados se obtienen los valores predichos para el sitio. Para implementar este proceso en R, primero se debe generar un <code>data.frame</code> juntando los datos observados y la grilla de predicción. La función <code>bind_rows()</code> del paquete <code>dplyr</code> permite juntar dos data frames que contengan el mismo nombre de columnas colocando <code>NA</code> cuando no hay valor para un campo.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">suelos_pred_INLA &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(suelos_pred,</a>
<a class="sourceLine" id="cb129-2" data-line-number="2">                                     suelos)</a>
<a class="sourceLine" id="cb129-3" data-line-number="3"><span class="kw">head</span>(suelos_pred_INLA)</a>
<a class="sourceLine" id="cb129-4" data-line-number="4"><span class="co">#&gt; UNION JURISDICCI CAPITAL FUENTE elevacion</span></a>
<a class="sourceLine" id="cb129-5" data-line-number="5">twi pH arcilla X Y ID_<span class="dv">2</span></a>
<a class="sourceLine" id="cb129-6" data-line-number="6"><span class="co">#&gt; 1 -2,15e+09 CORDOBA CORDOBA IGN 275 118 6,39</span></a>
<a class="sourceLine" id="cb129-7" data-line-number="7"><span class="dv">8</span>,<span class="dv">21</span> <span class="dv">310499</span> <span class="dv">6129968</span> <span class="ot">NA</span></a>
<a class="sourceLine" id="cb129-8" data-line-number="8"><span class="co">#&gt; COS</span></a>
<a class="sourceLine" id="cb129-9" data-line-number="9"><span class="co">#&gt; 1 NA</span></a>
<a class="sourceLine" id="cb129-10" data-line-number="10"><span class="co">#&gt; [ reached &#39;max&#39;</span></a>
<a class="sourceLine" id="cb129-11" data-line-number="11">    <span class="op">/</span><span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;max.print&quot;</span>) <span class="op">--</span></a>
<a class="sourceLine" id="cb129-12" data-line-number="12">omitted <span class="dv">5</span> rows ]</a></code></pre></div>
<p>Luego de identificar el predictor lineal, debe definirse la malla y el modelo espacial para la grilla de predicción asociada a los efectos aleatorios de sitios. Mediante el argumento <code>control.predictor</code> en la función <code>inla()</code> se indica que debe computarse el valor de la variable respuesta en el lugar del dato faltante.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">malla_pred &lt;-<span class="st"> </span><span class="kw">inla.mesh.2d</span>(sitios_pred, </a>
<a class="sourceLine" id="cb130-2" data-line-number="2">                           <span class="dt">cutoff =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb130-3" data-line-number="3">                           <span class="dt">max.edge =</span> <span class="dv">200000</span>)</a></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"></a>
<a class="sourceLine" id="cb131-2" data-line-number="2">sitios_pred &lt;-<span class="st"> </span>suelos_pred_INLA[, <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)]</a>
<a class="sourceLine" id="cb131-3" data-line-number="3"></a>
<a class="sourceLine" id="cb131-4" data-line-number="4">nodos_pred &lt;-<span class="st"> </span>malla_pred<span class="op">$</span>idx<span class="op">$</span>loc</a>
<a class="sourceLine" id="cb131-5" data-line-number="5"></a>
<a class="sourceLine" id="cb131-6" data-line-number="6">spde_pred &lt;-</a>
<a class="sourceLine" id="cb131-7" data-line-number="7"><span class="st">  </span><span class="kw">inla.spde2.matern</span>(<span class="dt">mesh =</span> malla_pred, <span class="dt">alpha =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb131-8" data-line-number="8"></a>
<a class="sourceLine" id="cb131-9" data-line-number="9">pred_INLAspde &lt;-</a>
<a class="sourceLine" id="cb131-10" data-line-number="10"><span class="st">  </span><span class="kw">inla</span>(</a>
<a class="sourceLine" id="cb131-11" data-line-number="11">    COS <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>elevacion <span class="op">+</span><span class="st"> </span>twi <span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb131-12" data-line-number="12"><span class="st">      </span><span class="kw">f</span>(nodos_pred, <span class="dt">model =</span> spde_pred, <span class="dt">diagonal =</span> <span class="fl">1e-6</span>),</a>
<a class="sourceLine" id="cb131-13" data-line-number="13">    <span class="dt">family =</span> <span class="st">&#39;gaussian&#39;</span>,</a>
<a class="sourceLine" id="cb131-14" data-line-number="14">    <span class="dt">data =</span> suelos_pred_INLA,</a>
<a class="sourceLine" id="cb131-15" data-line-number="15">    <span class="dt">control.predictor =</span> <span class="kw">list</span>(<span class="dt">link =</span> <span class="dv">1</span>, <span class="dt">compute =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb131-16" data-line-number="16">  )</a></code></pre></div>
<p>Se puede obtener la media de la distribución a posteriori de los valores predichos para cada sitio en la grilla de predicción, para mapear la distribución espacial de la variable respuesta.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">pred_err_corr &lt;-</a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw">cbind</span>(pred_err_corr,</a>
<a class="sourceLine" id="cb132-3" data-line-number="3">        <span class="st">&quot;COS_pred_INLA&quot;</span> =</a>
<a class="sourceLine" id="cb132-4" data-line-number="4"><span class="st">          </span>pred_INLAspde<span class="op">$</span>summary.fitted.values<span class="op">$</span>mean</a>
<a class="sourceLine" id="cb132-5" data-line-number="5">        [<span class="kw">is.na</span>(suelos_pred_INLA<span class="op">$</span>COS)])</a>
<a class="sourceLine" id="cb132-6" data-line-number="6"></a>
<a class="sourceLine" id="cb132-7" data-line-number="7"><span class="kw">tm_shape</span>(pred_err_corr) <span class="op">+</span></a>
<a class="sourceLine" id="cb132-8" data-line-number="8"><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&quot;COS_pred_INLA&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;cont&quot;</span>)</a></code></pre></div>
<p><img src="figuras/figLibro/unionpredichosinla-1.png" width="\linewidth" style="display: block; margin: auto;" /></p>
</div>
<div id="regresión-vía-modelos-basados-en-árbol-1" class="section level2">
<h2><span class="header-section-number">8.3</span> Regresión vía modelos basados en árbol</h2>
<p>Se ajusta un modelo GBR o <em>gradient boosting model</em> con errores correlacionados espacialmente en dos pasos, primero se optimiza la parametrización del predictor GBR usando datos de los sitios observados y se obtienen los residuos de este modelo. En segunda instancia, se ajusta un modelo de semivariaograma a los residuos que se usará para realizar predicción kriging de residuos sobre toda la grilla de predicción. Finalmente, los residuos predichos se adicional a la componente sistemática predicha con el modelo GBR sobre la misma grilla de predicción.</p>
<p>Para implementar GBR se utiliza el paquete <code>caret</code>. Para optimizar el modelo GBM. se genera una grilla de valores posibles para sus parámetros con la función <code>expand.grid()</code>. Esta función genera un <code>data.frame</code> que contiene en las filas cada una de las combinaciones posibles generadas a partir de los rangos de valores propuestos para cada parámetro del modelo GBM. Éstos son: <code>n.trees</code> que definen el número total de árboles ajustados, <code>shrinkage</code> que regula la extensión de cada árbol, <code>n.minobsinnode</code> que representa el mínimo de observaciones en cada nodo terminal y <code>bag.fraction</code> la proporción de observaciones del grupo de entrenamiento seleccionadas aleatoriamente para la expansión sucesiva del árbol. El tipo de validación cruzada para la optimización de los parámetros del modelo se realiza a través de la función <code>train.control</code>. Luego utilizando la función <code>train()</code> se especifica el modelo con el argumento <code>method</code>, en este caso <code>gbm.</code> La misma función <code>train()</code> genera un objeto con el modelo parametrizado con la configuración valores que arrojan el menor error predictivo, es decir con un modelo del tipo árbol optimizado.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">param_gbm &lt;-<span class="st">  </span><span class="kw">expand.grid</span>(</a>
<a class="sourceLine" id="cb133-2" data-line-number="2">  <span class="dt">interaction.depth =</span> <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb133-3" data-line-number="3">  <span class="dt">n.trees =</span> (<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb133-4" data-line-number="4">  <span class="dt">shrinkage =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>),</a>
<a class="sourceLine" id="cb133-5" data-line-number="5">  <span class="dt">n.minobsinnode =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb133-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb133-7" data-line-number="7"></a>
<a class="sourceLine" id="cb133-8" data-line-number="8">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,</a>
<a class="sourceLine" id="cb133-9" data-line-number="9">                        <span class="dt">number =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb133-10" data-line-number="10">                        <span class="dt">repeats =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb133-11" data-line-number="11"></a>
<a class="sourceLine" id="cb133-12" data-line-number="12">ajuste_gbm &lt;-<span class="st"> </span><span class="kw">train</span>(</a>
<a class="sourceLine" id="cb133-13" data-line-number="13">  COS <span class="op">~</span><span class="st"> </span>elevacion <span class="op">+</span><span class="st"> </span>twi <span class="op">+</span><span class="st"> </span>arcilla <span class="op">+</span><span class="st"> </span>pH,</a>
<a class="sourceLine" id="cb133-14" data-line-number="14">  <span class="dt">data =</span> suelos,</a>
<a class="sourceLine" id="cb133-15" data-line-number="15">  <span class="dt">method =</span> <span class="st">&quot;gbm&quot;</span>,</a>
<a class="sourceLine" id="cb133-16" data-line-number="16">  <span class="dt">trControl =</span> control,</a>
<a class="sourceLine" id="cb133-17" data-line-number="17">  <span class="dt">verbose =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb133-18" data-line-number="18">  <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</a>
<a class="sourceLine" id="cb133-19" data-line-number="19">  <span class="dt">tuneGrid =</span> param_gbm</a>
<a class="sourceLine" id="cb133-20" data-line-number="20">)</a></code></pre></div>
<p>Pidiendo un gráfico del objeto <code>ajuste_gbm</code> se puede acceder al resumen del proceso de optimización de los parámetros. El rendimiento del modelo depende de estos parámetros, pero es posible identificar las combinaciones que generan el mejor desempeño predictivo. A su vez, a través del comando <code>ajuste_gbm$bestTune</code> podemos acceder a los parámetros que definen el modelo óptimo.</p>
<p>```r</p>
<p>plot(ajuste_gbm)
ajuste_gbm$bestTune
#&gt; n.trees interaction.depth shrinkage
n.minobsinnode
#&gt; 173 2300 4 0,001 7
```<img src="figuras/figLibro/mejorajustegbm-1.png" width="\linewidth" style="display: block; margin: auto;" /></p>
<p>El objeto resultante del ajuste GBM, provee un gráfico de la influencia relativa de cada variable predictora para explicar COS, y el árbol con el que se realizará la predicción. A partir de la función <code>predict()</code> sobre los datos observados, se obtienen predichos y consecuentemente los residuos del modelo GBR.</p>
<p>```r</p>
<p>summary(ajuste_gbm)
#&gt; var rel.inf
#&gt; twi twi 39,30
#&gt; arcilla arcilla 38,53
#&gt; elevacion elevacion 14,02
#&gt; pH pH 8,15
```<img src="figuras/figLibro/resumenajustegbm-1.png" width="\linewidth" style="display: block; margin: auto;" /></p>
<p>En la segunda etapa, se ajusta una función de semivarianza a los residuos del modelo GBM utilizando las funciones <code>variogram</code> y <code>fit.variogram</code> del paquete <code>gstat</code>.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">suelos<span class="op">$</span>residuosgbm &lt;-</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="st">  </span>suelos<span class="op">$</span>COS <span class="op">-</span><span class="st"> </span><span class="kw">predict</span>(ajuste_gbm, </a>
<a class="sourceLine" id="cb134-3" data-line-number="3">                       <span class="dt">newdata =</span> suelos)</a>
<a class="sourceLine" id="cb134-4" data-line-number="4"></a>
<a class="sourceLine" id="cb134-5" data-line-number="5"><span class="kw">coordinates</span>(suelos) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)</a>
<a class="sourceLine" id="cb134-6" data-line-number="6"></a>
<a class="sourceLine" id="cb134-7" data-line-number="7"><span class="kw">crs</span>(suelos) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:32720&quot;</span>)</a>
<a class="sourceLine" id="cb134-8" data-line-number="8"></a>
<a class="sourceLine" id="cb134-9" data-line-number="9">semiv_gbmk &lt;-<span class="st"> </span><span class="kw">variogram</span>(residuosgbm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, suelos)</a>
<a class="sourceLine" id="cb134-10" data-line-number="10"></a>
<a class="sourceLine" id="cb134-11" data-line-number="11"><span class="kw">plot</span>(semiv_gbmk)</a>
<a class="sourceLine" id="cb134-12" data-line-number="12"></a>
<a class="sourceLine" id="cb134-13" data-line-number="13">semiv_aj_gbmk &lt;-</a>
<a class="sourceLine" id="cb134-14" data-line-number="14"><span class="st">  </span><span class="kw">fit.variogram</span>(semiv_gbmk ,</a>
<a class="sourceLine" id="cb134-15" data-line-number="15">                <span class="kw">vgm</span>(<span class="kw">c</span>(<span class="st">&quot;Exp&quot;</span>, <span class="st">&quot;Sph&quot;</span>, <span class="st">&quot;Gau&quot;</span>)))</a>
<a class="sourceLine" id="cb134-16" data-line-number="16"><span class="kw">plot</span>(semiv_gbmk , semiv_aj_gbmk)</a>
<a class="sourceLine" id="cb134-17" data-line-number="17"></a>
<a class="sourceLine" id="cb134-18" data-line-number="18"><span class="kw">coordinates</span>(suelos_pred) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)</a>
<a class="sourceLine" id="cb134-19" data-line-number="19"><span class="kw">crs</span>(suelos_pred) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:32720&quot;</span>)</a></code></pre></div>
<p><img src="figuras/figLibro/unnamed-chunk-185-1.png" width="\linewidth" style="display: block; margin: auto;" /><img src="figuras/figLibro/unnamed-chunk-185-2.png" width="\linewidth" style="display: block; margin: auto;" /></p>
<p>Para obtener un predicción de COS en los sitios no muestreados, se realiza la predicción kriging de los residuos sobre los sitios de la grilla de predicción utilizando el modelo ajustado en el paso anterior a partir de la función <code>krige()</code>. Luego se utiliza el modelo GBM (árbol optimo) para predecir COS sobre la grilla de predicción sin considerar la espacialidad. Finalmente, la predicción de COS en cada sitio se compone sumando la predicción del modelo GBM y la predicción kriging de los residuos para cada sitio de la grilla de predicción.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">krig_res_gbm &lt;-</a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw">krige</span>(</a>
<a class="sourceLine" id="cb135-3" data-line-number="3">    residuosgbm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb135-4" data-line-number="4">    <span class="dt">location =</span> suelos,</a>
<a class="sourceLine" id="cb135-5" data-line-number="5">    <span class="dt">newdata =</span> suelos_pred,</a>
<a class="sourceLine" id="cb135-6" data-line-number="6">    <span class="dt">model =</span> semiv_aj_gbmk</a>
<a class="sourceLine" id="cb135-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb135-8" data-line-number="8"><span class="co">#&gt; [using ordinary kriging]</span></a>
<a class="sourceLine" id="cb135-9" data-line-number="9"></a>
<a class="sourceLine" id="cb135-10" data-line-number="10">gbmk_pred &lt;-</a>
<a class="sourceLine" id="cb135-11" data-line-number="11"><span class="st">  </span><span class="kw">predict</span>(ajuste_gbm,</a>
<a class="sourceLine" id="cb135-12" data-line-number="12">          <span class="dt">newdata =</span> suelos_pred, </a>
<a class="sourceLine" id="cb135-13" data-line-number="13">          <span class="dt">na.action =</span> na.pass) <span class="op">+</span></a>
<a class="sourceLine" id="cb135-14" data-line-number="14"><span class="st">  </span>krig_res_gbm<span class="op">$</span>var1.pred</a>
<a class="sourceLine" id="cb135-15" data-line-number="15"></a>
<a class="sourceLine" id="cb135-16" data-line-number="16">pred_err_corr &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb135-17" data-line-number="17"><span class="st">  </span><span class="kw">cbind</span>(pred_err_corr,</a>
<a class="sourceLine" id="cb135-18" data-line-number="18">        <span class="st">&quot;COS_pred_GBM&quot;</span> =<span class="st"> </span>gbmk_pred)</a>
<a class="sourceLine" id="cb135-19" data-line-number="19"></a>
<a class="sourceLine" id="cb135-20" data-line-number="20"><span class="kw">tm_shape</span>(pred_err_corr) <span class="op">+</span></a>
<a class="sourceLine" id="cb135-21" data-line-number="21"><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&quot;COS_pred_GBM&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;cont&quot;</span>)</a></code></pre></div>
<p><img src="figuras/figLibro/predichosgbm-1.png" width="\linewidth" style="display: block; margin: auto;" /></p>


</div>
</div>



</div>
<script>
/*
Sorts the references alphabetically.
Modified from code by Yvonne Aburrow.
*/
$(function(){
    var elems = $('#refs').children('div').remove();
    elems.sort(function (a, b) {
        return $(b).children('p').html().toUpperCase() > $(a).children('p').html().toUpperCase() ? -1 : 1;
    });
    $('#refs').append(elems);
})
</script>
            </section>

          </div>
        </div>
      </div>
<a href="bases-de-datos-regionales.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="herramientas-de-software.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["PROTRI2018-VariabilidadEspacial.pdf", "PROTRI2018-VariabilidadEspacial.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
